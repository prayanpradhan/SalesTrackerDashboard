<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>E-Resourcing Sales Dashboard</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
body {font-family:'Inter',sans-serif;background:#fff;color:#1a2b48;margin:0;}
header{display:flex;justify-content:space-between;align-items:center;padding:20px 40px;background:#fff;
border-bottom:1px solid #e0e8f0;box-shadow:0 2px 8px rgba(0,0,0,0.05);}
header img{height:90px;}
h1{font-size:22px;font-weight:700;margin:0;}
.date{font-size:13px;color:#555;margin-top:5px;}
main{padding:30px 40px;}
.progress-card,.tab-container,.history-container{background:#fff;border:1px solid #e0e8f0;border-radius:16px;
.subtitle {
  margin-bottom: 20px;
  font-size: 14px;
  color: #666;
}
padding:25px 30px;box-shadow:0 4px 16px rgba(0,0,0,0.05);}
.metrics-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-top:30px;text-align:left;}
.metric-card{border-radius:16px;padding:20px;box-shadow:0 4px 12px rgba(0,0,0,0.08);display:flex;flex-direction:column;align-items:flex-start;}
.metric-card.sales{background:#e8fef4;border:1px solid #c8f5e2;}
.metric-card.target{background:#e8f2ff;border:1px solid #c4daff;}
.metric-card.remaining{background:#fff8e8;border:1px solid #ffe8c4;}
.metric-card div:first-child{display:flex;align-items:center;gap:8px;font-size:14px;font-weight:600;color:#333;}
.metric-card strong{font-size:24px;display:block;margin-top:4px;font-weight:700;}
.progress-bar-wrapper{position:relative;width:100%;height:20px;background:#e0e8f0;border-radius:10px;}
.progress-fill{height:100%;background:linear-gradient(90deg,#6c5ce7,#0984e3);border-radius:10px;transition:width .4s ease-out;position:relative;}
.progress-logo-container{position:absolute;right:-25px;top:50%;transform:translateY(-50%);width:50px;height:50px;display:flex;align-items:center;justify-content:center;z-index:5;}
.progress-logo-container img{width:100%;height:100%;object-fit:contain;border-radius:50%;box-shadow:0 2px 8px rgba(0,0,0,0.15);background:white;}
.percentage-tag{position:absolute;top:calc(100% + 10px);left:50%;transform:translateX(-50%);background:white;color:#1a2b48;padding:4px 8px;border-radius:6px;font-size:14px;font-weight:700;box-shadow:0 2px 4px rgba(0,0,0,0.1);white-space:nowrap;z-index:6;}
.progress-scale{display:flex;justify-content:space-between;font-size:12px;color:#666;margin-top:30px;}
.inputs{display:flex;justify-content:center;gap:30px;margin:0 0 50px 0;flex-wrap:wrap;padding:0 40px;}
.tab-container{width:400px;min-width:320px;flex-shrink:0;padding:25px 30px;}
.tabs{display:flex;margin-bottom:20px;gap:8px;}
.tab{flex:1;background:#e0e8f0;border:none;padding:10px 15px;cursor:pointer;font-weight:600;color:#1a2b48;
border-radius:8px;transition:background .2s,box-shadow .2s;font-size:14px;}
.tab.active{background:#3498db;color:white;box-shadow:0 2px 6px rgba(52,152,219,0.3);}
.tab-panel{display:none;}
.tab-panel.active{display:block;}
.tab-content label{display:block;text-align:left;font-size:13px;margin-bottom:6px;color:#555;}
.tab-content input{width:100%;box-sizing:border-box;margin-bottom:15px;padding:10px;border:1px solid #e0e8f0;border-radius:8px;font-family:'Inter',sans-serif;transition:border-color .2s;}
.tab-content input:focus{border-color:#3498db;outline:none;}
.tab-content button{width:100%;background-color:#2ecc71;color:white;border:none;padding:12px;border-radius:8px;cursor:pointer;font-weight:600;font-size:16px;}
.tab-content button:hover{background-color:#27ae60;}
.history-container{width:400px;min-width:320px;flex-shrink:0;max-height:450px;overflow-y:auto;}
.history-container h3{margin-top:0;font-size:18px;font-weight:700;color:#1a2b48;margin-bottom:15px;display:flex;align-items:center;gap:8px;}
.history-filters{margin-bottom:15px;display:flex;gap:8px;}
.filter-btn{background:#f0f4f8;border:none;padding:6px 12px;cursor:pointer;font-weight:600;color:#555;border-radius:6px;transition:background .2s;font-size:13px;}
.filter-btn:hover{background:#e0e8f0;}
.filter-btn.active-filter{background:#1a2b48;color:white;}
.history-entry{display:flex;justify-content:space-between;align-items:center;background:#fcfcfc;border:1px solid #e0e8f0;border-radius:8px;padding:10px 15px;margin-bottom:10px;font-size:14px;}
.history-entry.deal{background:#f3fff9;border-color:#d8f5e9;}
.history-entry.et{background:#fff3f3;border-color:#f5d8d8;}
.entry-details{display:flex;flex-direction:column;}
.entry-name{font-weight:600;color:#1a2b48;}
.entry-date{font-size:11px;color:#999;margin-top:2px;}
.entry-amount{font-weight:700;display:flex;align-items:center;gap:10px;}
.entry-amount .plus{color:#2ecc71;}
.entry-amount .minus{color:#e74c3c;}
.delete-btn{background:none;border:none;color:#999;border-radius:4px;padding:4px;cursor:pointer;font-size:14px;margin-left:10px;}
.delete-btn:hover{color:#e74c3c;}
/* --- BACKUP BUTTON STYLING --- */
.backup-container {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin: 40px 0;
  flex-wrap: wrap;
}

.backup-btn {
  font-family: 'Inter', sans-serif;
  font-size: 15px;
  font-weight: 600;
  color: #1a2b48;
  background: #ffffff;
  border: 1px solid #e0e8f0;
  border-radius: 16px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
  padding: 14px 28px;
  cursor: pointer;
  transition: all 0.2s ease-in-out;
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

.backup-btn:hover {
  background: #f5fbff;
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
}

.backup-btn.export {
  color: #2e86de;
}

.backup-btn.import {
  color: #27ae60;
  position: relative;
}

.backup-btn input {
  position: absolute;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  opacity: 0;
  cursor: pointer;
}

/* --- RESPONSIVE SECTION BELOW --- */
@media(max-width:900px){
   ...
}

@media(max-width:900px){
main{padding:20px;}
.metrics-grid{grid-template-columns:1fr;gap:15px;}
.inputs{flex-direction:column;align-items:center;gap:20px;padding:0;}
.tab-container,.history-container{width:90%;max-width:450px;min-width:unset;margin:0 20px;}
.progress-logo-container{width:40px;height:40px;right:-20px;}
.percentage-tag{top:calc(100% + 5px);font-size:12px;}
.progress-scale{margin-top:25px;}
}
</style>
</head>
<body>
<header>
  <div>
    <h1>E-Resourcing Sales Dashboard</h1>
    <div class="date" id="lastUpdated">Last updated: ‚Äî</div>
  </div>
  <img src="eresourcing-logo.png" alt="E-Resourcing Logo" />
</header>

<main>
  <div class="progress-card">
    <div class="title">Sales Progress</div>
    <div class="subtitle">Progress towards annual target</div>
    <div class="progress-bar-wrapper">
      <div class="progress-fill" id="fill">
        <div class="progress-logo-container" id="progressLogoContainer">
          <img src="roundlogo.png" alt="Progress Logo">
          <div class="percentage-tag" id="progressPercentage">0.0%</div>
        </div>
      </div>
    </div>
    <div class="progress-scale"><span>0%</span><span>100%</span></div>
    <div class="metrics-grid">
      <div class="metric-card sales"><div>üìà Current Sales</div><strong id="salesVal">¬£0</strong></div>
      <div class="metric-card target"><div>üéØ Annual Target</div><strong id="targetVal">¬£0</strong></div>
      <div class="metric-card remaining"><div>‚è≥ Remaining</div><strong id="remainVal">¬£0</strong></div>
    </div>
  </div>
</main>

<div class="inputs">
  <div class="tab-container">
    <div class="tabs">
      <button class="tab active" id="tabAdd" onclick="switchTab('add')">New Deal</button>
      <button class="tab" id="tabDeduct" onclick="switchTab('deduct')">Early Termination</button>
      <button class="tab" id="tabTarget" onclick="switchTab('target')">Adjust Target</button>
    </div>
    <div class="tab-content">
      <div id="addTab" class="tab-panel active">
        <label>Deal Name</label>
        <input type="text" id="dealName" placeholder="Enter deal name">
        <label>Amount (¬£)</label>
        <input type="number" id="saleInput" min="0" step="100" placeholder="Enter amount">
        <button onclick="handleTransaction('add')">Add Deal</button>
      </div>
      <div id="deductTab" class="tab-panel">
        <label>Termination Name</label>
        <input type="text" id="deductName" placeholder="Enter termination name">
        <label>Amount (¬£)</label>
        <input type="number" id="deductInput" min="0" step="100" placeholder="Enter amount">
        <button style="background-color:#e74c3c;" onclick="handleTransaction('deduct')">Apply Deduction</button>
      </div>
      <div id="targetTab" class="tab-panel">
        <label>Set New Target (¬£)</label>
        <input type="number" id="targetInput" min="0" step="100" placeholder="Enter target">
        <button style="background-color:#3498db;" onclick="updateTarget()">Update Target</button>
      </div>
    </div>
  </div>

  <div class="history-container">
    <h3>‚è±Ô∏è Transaction History</h3>
    <div class="history-filters">
      <button class="filter-btn active-filter" data-filter="all" onclick="setFilter('all')">All (<span id="countAll">0</span>)</button>
      <button class="filter-btn" data-filter="Deal" onclick="setFilter('Deal')">Deals (<span id="countDeal">0</span>)</button>
      <button class="filter-btn" data-filter="ET" onclick="setFilter('ET')">Terminations (<span id="countET">0</span>)</button>
    </div>
    <div id="historyList"></div>
  </div>
</div>

<!-- Backup Controls -->
<div class="backup-container">
  <button class="backup-btn export" onclick="exportBackup()">üì§ Export Backup</button>
  <label class="backup-btn import">
    üì• Import Backup
    <input type="file" accept=".json" onchange="importBackup(this.files[0])" style="display:none;">
  </label>
</div>


<script>
let sales=0,target=0,history=[],salesData=[{date:new Date().toLocaleDateString('en-GB'),cumulativeSales:0}],currentFilter='all';

function updateTimestamp(){
  const now=new Date();
  document.getElementById("lastUpdated").textContent="Last updated: "+now.toLocaleDateString('en-GB',{day:'numeric',month:'long',year:'numeric'});
}

function loadData(){
  try{
    sales=parseFloat(localStorage.getItem("sales"))||0;
    target=parseFloat(localStorage.getItem("target"))||0;
    history=JSON.parse(localStorage.getItem("history"))||[];
    salesData=JSON.parse(localStorage.getItem("salesData"))||[{date:new Date().toLocaleDateString('en-GB'),cumulativeSales:0}];
  }catch(e){history=[];salesData=[{date:new Date().toLocaleDateString('en-GB'),cumulativeSales:0}];}
}

function saveData(){
  try{
    localStorage.setItem("sales",sales);
    localStorage.setItem("target",target);
    localStorage.setItem("history",JSON.stringify(history));
    localStorage.setItem("salesData",JSON.stringify(salesData));
  }catch(e){console.error("Save failed",e);}
}

function updateState(save=true){
  const percent=target>0?(sales/target)*100:0;
  const clamped=Math.min(percent,100);
  const remain=Math.max(target-sales,0);
  document.getElementById("fill").style.width=clamped+"%";
  document.getElementById("salesVal").textContent="¬£"+sales.toLocaleString();
  document.getElementById("targetVal").textContent="¬£"+target.toLocaleString();
  document.getElementById("remainVal").textContent="¬£"+remain.toLocaleString();
  document.getElementById("progressPercentage").textContent=percent.toFixed(1)+"%";
  renderHistory();
  updateFilterCounts();
  updateTimestamp();
  if(save)saveData();
}

function handleTransaction(type){
  const isAdd=type==="add";
  const nameId=isAdd?"dealName":"deductName";
  const valId=isAdd?"saleInput":"deductInput";
  const name=document.getElementById(nameId).value.trim()||(isAdd?"New Deal":"Termination");
  let val=parseFloat(document.getElementById(valId).value);
  if(isNaN(val)||val<=0){alert("Enter a valid amount.");return;}
  val=Math.round(val*100)/100;
  const amt=isAdd?val:-val;
  sales+=amt;if(sales<0)sales=0;
  const date=new Date();
  history.push({id:date.getTime(),type:isAdd?"Deal":"ET",name,amount:amt,date:date.toLocaleDateString('en-GB')});
  rebuildSalesDataFromHistory();
  document.getElementById(valId).value="";document.getElementById(nameId).value="";
  updateState();
  switchTab(type);
}

function updateTarget(){
  let val=parseFloat(document.getElementById("targetInput").value);
  if(isNaN(val)||val<=0){alert("Enter valid target.");return;}
  target=Math.round(val*100)/100;
  document.getElementById("targetInput").value="";
  updateState();
}

function deleteEntry(id){
  const i=history.findIndex(e=>e.id===id);
  if(i===-1)return;
  sales-=history[i].amount;if(sales<0)sales=0;
  history.splice(i,1);
  rebuildSalesDataFromHistory();
  updateState();
}

function rebuildSalesDataFromHistory(){
  salesData=[{date:new Date().toLocaleDateString('en-GB'),cumulativeSales:0}];
  let c=0;
  history.sort((a,b)=>a.id-b.id).forEach(it=>{
    c+=it.amount;
    const d=it.date;
    if(salesData.length&&salesData[salesData.length-1].date===d) salesData[salesData.length-1].cumulativeSales=c;
    else salesData.push({date:d,cumulativeSales:c});
  });
}

function updateFilterCounts(){
  const d=history.filter(i=>i.type==="Deal").length;
  const e=history.filter(i=>i.type==="ET").length;
  document.getElementById("countAll").textContent=history.length;
  document.getElementById("countDeal").textContent=d;
  document.getElementById("countET").textContent=e;
}

function setFilter(f){
  currentFilter=f;
  document.querySelectorAll(".filter-btn").forEach(b=>b.classList.remove("active-filter"));
  document.querySelector(`.filter-btn[data-filter="${f}"]`).classList.add("active-filter");
  renderHistory();
}

function renderHistory(){
  const list=document.getElementById("historyList");
  const filtered=history.filter(i=>currentFilter==="all"||i.type===currentFilter);
  if(!filtered.length){list.innerHTML="<p style='font-size:13px;color:#555;padding:10px 0;'>No entries.</p>";return;}
  list.innerHTML=filtered.slice().sort((a,b)=>b.id-a.id).map(it=>{
    const sign=it.amount>=0?"+":"‚Äì";
    const cls=it.amount>=0?"plus":"minus";
    const typeCls=it.type==="Deal"?"deal":"et";
    return `<div class="history-entry ${typeCls}">
      <div class="entry-details"><span class="entry-name">${it.name}</span><span class="entry-date">${it.date}</span></div>
      <div class="entry-amount"><span class="${cls}">${sign}¬£${Math.abs(it.amount).toLocaleString()}</span>
      <button class="delete-btn" onclick="deleteEntry(${it.id})">üóëÔ∏è</button></div></div>`;
  }).join('');
}

function switchTab(t){
  ["add","deduct","target"].forEach(x=>{
    document.getElementById("tab"+x.charAt(0).toUpperCase()+x.slice(1)).classList.remove("active");
    document.getElementById(x+"Tab").classList.remove("active");
  });
  document.getElementById("tab"+t.charAt(0).toUpperCase()+t.slice(1)).classList.add("active");
  document.getElementById(t+"Tab").classList.add("active");
}

/* --- Backup Export/Import --- */
function exportBackup(){
  const data={
    sales:localStorage.getItem("sales"),
    target:localStorage.getItem("target"),
    history:localStorage.getItem("history"),
    salesData:localStorage.getItem("salesData")
  };
  const blob=new Blob([JSON.stringify(data,null,2)],{type:"application/json"});
  const link=document.createElement("a");
  link.href=URL.createObjectURL(blob);
  link.download="sales_dashboard_backup.json";
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

function importBackup(file){
  const reader=new FileReader();
  reader.onload=e=>{
    try{
      const data=JSON.parse(e.target.result);
      Object.entries(data).forEach(([k,v])=>localStorage.setItem(k,v));
      alert("Backup imported. Reloading...");
      location.reload();
    }catch{alert("Invalid file.");}
  };
  reader.readAsText(file);
}

window.onload=function(){loadData();rebuildSalesDataFromHistory();updateState(false);};
</script>
</body>
</html>
